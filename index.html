<!doctype html>
<html lang="en">
  <head>
    <script type="module">
    const modelViewer = document.querySelector('model-viewer');
    const hotspotsContainer = document.querySelector('.hotspots-container');
    const hotspots = [];

    modelViewer.addEventListener('click', event => {
      const { offsetX, offsetY } = event;

      // Calculate 3D coordinates based on click position
      const point = modelViewer.pointFromPixel(offsetX, offsetY);

      // Create hotspot element
      const hotspot = document.createElement('div');
      hotspot.classList.add('hotspot');
      hotspot.style.left = `${offsetX}px`;
      hotspot.style.top = `${offsetY}px`;

      // Add a marker or icon for the hotspot
      hotspot.innerHTML = 'H'; // You can replace this with your preferred marker or icon

      // Store the hotspot data
      const hotspotData = {
        position: point,
        marker: 'H', // You can store the marker/icon information here
      };
      hotspots.push(hotspotData);

      hotspot.addEventListener('click', () => {
        // Handle click on the hotspot (e.g., show details or perform an action)
        alert('Hotspot clicked!');
      });

      hotspot.addEventListener('contextmenu', (e) => {
        // Prevent the default context menu (right-click menu)
        e.preventDefault();
        
        // Handle right-click on the hotspot (e.g., delete the hotspot)
        const index = hotspots.indexOf(hotspotData);
        if (index !== -1) {
          hotspotsContainer.removeChild(hotspot);
          hotspots.splice(index, 1);
        }
      });

      hotspotsContainer.appendChild(hotspot);
    });

    // Function to save hotspots
    function saveHotspots() {
      // Serialize the hotspots data and save it to storage (e.g., localStorage)
      localStorage.setItem('hotspots', JSON.stringify(hotspots));
      console.log('Hotspots saved.');
    }

    // Function to load hotspots
    function loadHotspots() {
      // Load the hotspots data from storage (e.g., localStorage)
      const savedHotspots = localStorage.getItem('hotspots');
      if (savedHotspots) {
        hotspots.push(...JSON.parse(savedHotspots));

        // Display saved hotspots
        hotspots.forEach(hotspotData => {
          const { position, marker } = hotspotData;

          const hotspot = document.createElement('div');
          hotspot.classList.add('hotspot');
          hotspot.style.left = `${position.x * 100}%`;
          hotspot.style.top = `${position.y * 100}%`;
          hotspot.innerHTML = marker;
          hotspotsContainer.appendChild(hotspot);

          hotspot.addEventListener('click', () => {
            alert('Hotspot clicked!');
          });
        });

        console.log('Hotspots loaded.');
      }
    }

    // Load hotspots when the page loads
    loadHotspots();

    // Save hotspots when the user requests it (e.g., button click)
    document.querySelector('#saveHotspotsButton').addEventListener('click', saveHotspots);
  </script>
  <style>
    .hotspots-container {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .hotspot {
      position: absolute;
      font-size: 20px;
      color: red;
      cursor: pointer;
      user-select: none;
    }

    #saveHotspotsButton {
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #saveHotspotsButton:hover {
      background-color: #0056b3;
    }
  </style>
  </head>
  <body>
    <!-- <model-viewer> HTML element -->
    <model-viewer src="renault_clio_rs.glb" ar ar-modes="scene-viewer quick-look" camera-controls poster="poster.webp" shadow-intensity="1">
      <div class="progress-bar hide" slot="progress-bar">
          <div class="update-bar"></div>
      </div>
      <button slot="ar-button" id="ar-button">
          View in your space
      </button>
      <div id="ar-prompt">
          <img src="ar_hand_prompt.png">
      </div>
    </model-viewer>  
    <div class="hotspots-container"></div>
    <button id="saveHotspotsButton">Save Hotspots</button>
    <script src="script.js"></script>
    <!-- Loads <model-viewer> for browsers: -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.2.0/model-viewer.min.js"></script>
  </body>
</html>
